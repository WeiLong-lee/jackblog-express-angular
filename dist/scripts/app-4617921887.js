!function(){"use strict";angular.module("jackblog",["ngAnimate","ngCookies","ngTouch","ngSanitize","ui.router","ui.bootstrap","ngLodash","ngProgress","toaster","ngFileUpload","jackblog.resources","jackblog.service","jackblog.filter","jackblog.directives","jackblog.manage","jackblog.article","jackblog.settings"]).config(["$logProvider","$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider",function(t,a,e,n,o){n.html5Mode(!0),o.defaults.timeout=5e5,o.interceptors.push("AuthInterceptor"),t.debugEnabled(!0),e.otherwise("/")}]).run(["$rootScope","ngProgressFactory","$state","lodash","Auth","Blog","$cookies","CustomModalService","toaster",function(t,a,e,n,o,i,l,s,r){t.default_avatar="/assets/images/avatar.png",i.getIndexImage().then(function(a){t.indexImg=a.img})["catch"](function(){t.indexImg="/assets/images/shanghai.jpg"}),t.opneSnsModal=function(){s.open("SnsSignInCtrl","app/settings/sns_sign_in.html")},t.progressbar=a.createInstance();var c=["/signin","/signup"],d=function(t){return n.find(c,function(a){return n.startsWith(t,a)})};t.$on("$stateChangeStart",function(a,n){t.progressbar.setColor("green"),t.progressbar.reset(),t.progressbar.start(),o.isLoggedInAsync(function(t){d(n.url)&&t?(a.preventDefault(),e.go("home")):n.onlyAdmin&&!o.isAdmin()?(a.preventDefault(),e.go("home")):n.onlyUser&&!t&&(a.preventDefault(),e.go("home"))})}),t.$on("$stateChangeSuccess",function(a,e,n,o,i){t.progressbar.complete(),t.previousState=o,t.previousParams=i}),t.$on("$locationChangeSuccess",function(a,e,n){t.currentUrl=e,t.previousUrl=n;var o=l.get("snsmsg");o&&(o=JSON.parse(o),r.pop(o.msgtype,"",o.msg),l.remove("snsmsg"))}),t.$on("$stateChangeError",function(){t.progressbar.reset()})}])}(),function(){"use strict";angular.module("jackblog").controller("SidebarCtrl",["$scope",function(t){t.name="Jack Hu"}])}(),function(){"use strict";angular.module("jackblog.service",[])}(),function(){"use strict";angular.module("jackblog.service").factory("CustomModalService",["$modal",function(t){return{open:function(a,e,n){t.open({templateUrl:e,controller:a,size:n})}}}])}(),function(){"use strict";angular.module("jackblog.service").factory("Auth",["$location","$rootScope","$http","User","$cookies","$q","lodash","$window",function(t,a,e,n,o,i,l,s){var r={};return o.get("token")&&(r=n.get()),{login:function(t,a){var l=a||angular.noop,s=i.defer();return e.post("/auth/local",{email:t.email,password:t.password,captcha:t.captcha}).success(function(t){return o.put("token",t.token),r=n.get(),s.resolve(t),l()}).error(function(t){return this.logout(),s.reject(t),l(t)}.bind(this)),s.promise},snsLogin:function(t,a){var e="/auth/"+t+"?redirectUrl="+(a||"/");o.get("token")&&(e+="&access_token="+o.get("token").replace(/(^\")|(\"$)/g,"")),s.location.href=e},logout:function(){o.remove("token"),r={}},getCurrentUser:function(){return r},isLoggedIn:function(){return r.hasOwnProperty("role")},isLoggedInAsync:function(t){r.hasOwnProperty("$promise")?r.$promise.then(function(){t(!0)})["catch"](function(){t(!1)}):t(r.hasOwnProperty("role")?!0:!1)},isLike:function(t){var a=l.findIndex(r.likes,function(a){return a.toString()===t});return-1!==a?!0:!1},isAdmin:function(){return"admin"===r.role},getToken:function(){return o.get("token")}}}])}(),function(){"use strict";angular.module("jackblog.service").factory("AuthInterceptor",["$rootScope","$q","$cookies","$location",function(t,a,e,n){return{request:function(t){return t.headers=t.headers||{},e.get("token")&&(t.headers.Authorization="Bearer "+e.get("token").replace(/(^\")|(\"$)/g,"")),t},response:function(t){return t},responseError:function(t){return 401===t.status?(e.remove("token"),n.path("/signin"),a.reject(t)):a.reject(t)}}}])}(),function(){"use strict";angular.module("jackblog.resources",["ngResource"])}(),function(){"use strict";angular.module("jackblog.resources").factory("User",["$resource",function(t){var a=t("/api/users/:id/:controller",{id:"@_id"},{getCaptcha:{method:"GET",params:{id:"getCaptcha"}},get:{method:"GET",params:{id:"me"}},getUserList:{method:"GET",params:{id:"getUserList"}},addUser:{method:"POST",params:{id:"addUser"}},updateUser:{method:"PUT",params:{controller:"updateUser"}},mdUser:{method:"PUT",params:{id:"mdUser"}},getUserProvider:{method:"GET",params:{id:"getUserProvider"}}});return{get:a.get,getCaptcha:function(t){var e=t||angular.noop;return a.getCaptcha(function(t){return e(t)},function(t){return e(t)}).$promise},getUserList:function(t,e){var n=e||angular.noop;return a.getUserList(function(t){return n(t)},function(t){return n(t)}).$promise},addUser:function(t,e){var n=e||angular.noop;return a.addUser(t,function(t){return n(t)},function(t){return n(t)}).$promise},deleteUser:function(t,e){var n=e||angular.noop;return a.remove(t,function(t){return n(t)},function(t){return n(t)}).$promise},updateUser:function(t,e,n){var o=n||angular.noop;return a.updateUser({id:t},e,function(t){return o(t)},function(t){return o(t)}).$promise},mdUser:function(t,e){var n=e||angular.noop;return a.mdUser(t,function(t){return n(t)},function(t){return n(t)}).$promise},getUserProvider:function(t){var e=t||angular.noop;return a.getUserProvider(function(t){return e(t)},function(t){return e(t)}).$promise}}}])}(),function(){"use strict";angular.module("jackblog.resources").factory("Tags",["$resource",function(t){var a=t("/api/tags/:id/:controller",{id:"@_id"},{addTagCat:{method:"POST",params:{id:"addTagCat"}},getTagCatList:{method:"GET",params:{id:"getTagCatList"}},updateTagCat:{method:"PUT",params:{controller:"updateTagCat"}},getTagList:{method:"GET",params:{controller:"getTagList"}},addTag:{method:"POST",params:{id:"addTag"}},deleteTag:{method:"DELETE",params:{controller:"deleteTag"}},updateTag:{method:"PUT",params:{controller:"updateTag"}},getFrontTagList:{method:"GET",params:{id:"getFrontTagList"}}});return{addTagCat:function(t,e){var n=e||angular.noop;return a.addTagCat(t,function(t){return n(t)},function(t){return n(t)}).$promise},getTagCatList:function(t){var e=t||angular.noop;return a.getTagCatList(function(t){return e(t)},function(t){return e(t)}).$promise},updateTagCat:function(t,e,n){var o=n||angular.noop;return a.updateTagCat({id:t},e,function(t){return o(t)},function(t){return o(t)}).$promise},deleteCat:function(t,e){var n=e||angular.noop;return a.remove(t,function(t){return n(t)},function(t){return n(t)}).$promise},getTagList:function(t,e){var n=e||angular.noop;return a.getTagList(t,function(t){return n(t)},function(t){return n(t)}).$promise},addTag:function(t,e){var n=e||angular.noop;return a.addTag(t,function(t){return n(t)},function(t){return n(t)}).$promise},deleteTag:function(t,e){var n=e||angular.noop;return a.deleteTag(t,function(t){return n(t)},function(t){return n(t)}).$promise},updateTag:function(t,e,n){var o=n||angular.noop;return a.updateTag({id:t},e,function(t){return o(t)},function(t){return o(t)}).$promise},getFrontTagList:function(t){var e=t||angular.noop;return a.getFrontTagList(function(t){return e(t)},function(t){return e(t)}).$promise}}}])}(),function(){"use strict";angular.module("jackblog.resources").factory("Comment",["$resource",function(t){var a=t("/api/comment/:id/:controller",{id:"@_id"},{getFrontCommentList:{method:"GET",params:{controller:"getFrontCommentList"}},addNewComment:{method:"POST",params:{id:"addNewComment"}},addNewReply:{method:"POST",params:{controller:"addNewReply"}},delReply:{method:"PUT",params:{controller:"delReply"}}});return{addNewComment:function(t,e){var n=e||angular.noop;return a.addNewComment(t,function(t){return n(t)},function(t){return n(t)}).$promise},getFrontCommentList:function(t,e){var n=e||angular.noop;return a.getFrontCommentList(t,function(t){return n(t)},function(t){return n(t)}).$promise},addNewReply:function(t,e,n){var o=n||angular.noop;return a.addNewReply({id:t},e,function(t){return o(t)},function(t){return o(t)}).$promise},delComment:function(t,e){var n=e||angular.noop;return a.remove(t,function(t){return n(t)},function(t){return n(t)}).$promise},delReply:function(t,e,n){var o=n||angular.noop;return a.delReply({id:t},e,function(t){return o(t)},function(t){return o(t)}).$promise}}}])}(),function(){"use strict";angular.module("jackblog.resources").factory("Blog",["$resource",function(t){var a=t("/api/blog/:id/:controller",{id:"@_id"},{addBlog:{method:"POST",params:{id:"addBlog"}},getBlogList:{method:"GET",params:{id:"getBlogList"}},updateBlog:{method:"PUT",params:{controller:"updateBlog"}},getBlog:{method:"GET",params:{controller:"getBlog"}},fetchImage:{method:"POST",params:{id:"fetchImage"}},getFrontBlogList:{method:"GET",params:{id:"getFrontBlogList"}},getFrontBlogCount:{method:"GET",params:{id:"getFrontBlogCount"}},getFrontArticle:{method:"GET",params:{controller:"getFrontArticle"}},getIndexImage:{method:"GET",params:{id:"getIndexImage"}},toggleLike:{method:"PUT",params:{controller:"toggleLike"}},getPrenext:{method:"GET",params:{controller:"getPrenext"}}});return{addBlog:function(t,e){var n=e||angular.noop;return a.addBlog(t,function(t){return n(t)},function(t){return n(t)}).$promise},getBlogList:function(t,e){var n=e||angular.noop;return a.getBlogList(t,function(t){return n(t)},function(t){return n(t)}).$promise},updateBlog:function(t,e,n){var o=n||angular.noop;return a.updateBlog({id:t},e,function(t){return o(t)},function(t){return o(t)}).$promise},deleteBlog:function(t,e){var n=e||angular.noop;return a.remove(t,function(t){return n(t)},function(t){return n(t)}).$promise},getBlog:function(t,e){var n=e||angular.noop;return a.getBlog(t,function(t){return n(t)},function(t){return n(t)}).$promise},fetchImage:function(t,e){var n=e||angular.noop;return a.fetchImage(t,function(t){return n(t)},function(t){return n(t)}).$promise},getFrontBlogList:function(t,e){var n=e||angular.noop;return a.getFrontBlogList(t,function(t){return n(t)},function(t){return n(t)}).$promise},getFrontBlogCount:function(t,e){var n=e||angular.noop;return a.getFrontBlogCount(t,function(t){return n(t)},function(t){return n(t)}).$promise},getFrontArticle:function(t,e){var n=e||angular.noop;return a.getFrontArticle(t,function(t){return n(t)},function(t){return n(t)}).$promise},getIndexImage:function(t){var e=t||angular.noop;return a.getIndexImage(function(t){return e(t)},function(t){return e(t)}).$promise},toggleLike:function(t,e){var n=e||angular.noop;return a.toggleLike(t,{},function(t){return n(t)},function(t){return n(t)}).$promise},getPrenext:function(t,e){var n=e||angular.noop;return a.getPrenext(t,function(t){return n(t)},function(t){return n(t)}).$promise}}}])}(),function(){"use strict";angular.module("jackblog").controller("NavbarCtrl",["$rootScope","$scope","$state","Auth",function(t,a,e,n){a.isLoggedIn=n.isLoggedIn,a.isAdmin=n.isAdmin,a.getCurrentUser=n.getCurrentUser,a.logout=function(){n.logout(),e.go("home",{},{reload:!0})},a.changeMode=function(){t.dayMode=!t.dayMode}}])}(),function(){"use strict";angular.module("jackblog").controller("FooterCtrl",["$scope",function(t){t.beian="©2015 / 鄂ICP备15010989号-1"}])}(),function(){"use strict";angular.module("jackblog.filter",[]).filter("userStatus",function(){return function(t){var a;switch(t){case 0:a="未验证";break;case 1:a="已验证";break;case 2:a="被阻止";break;default:a="未知状态"}return a}}).filter("customTime",function(){var t=(new Date).getTime(),a=6e4,e=60*a,n=24*e,o=30*n,i=12*o;return function(l){var s,r=new Date(l).getTime(),c=parseInt(t)-parseInt(r);return s=c>=i?parseInt(c/i)+"年前":i>c&&c>=o?parseInt(c/o)+"月前":o>c&&c>=n?parseInt(c/n)+"天前":n>c&&c>=e?parseInt(c/e)+"小时前":e>c&&c>=a?parseInt(c/a)+"分钟前":"刚刚"}})}(),function(){"use strict";angular.module("jackblog.directives",[])}(),function(){"use strict";angular.module("jackblog.directives").directive("email",function(){return{require:["ngModel","^?form"],link:function(t,a,e,n){var o=/^(\w)+(\.\w+)*@(\w)+((\.\w+)+)$/;n[0].$parsers.unshift(function(t){return o.test(t)?(n[0].$setValidity("email",!0),t):void n[0].$setValidity("email",!1)})}}}).directive("nickname",function(){return{require:"ngModel",link:function(t,a,e,n){var o=/^[(\u4e00-\u9fa5)0-9a-zA-Z\_\s@]+$/;n.$parsers.unshift(function(t){return o.test(t)?(n.$setValidity("nickname",!0),t):void n.$setValidity("nickname",!1)})}}})}(),function(){"use strict";angular.module("jackblog.directives").directive("scrolltop",["$window",function(t){return{restrict:"EA",replace:!0,template:'<div class="gotop" ng-show="isShowTop"><i class="fa fa-arrow-up"></i></div>',link:function(a,e,n){a.isShowTop=!1;var o=$("html,body");e.bind("click",function(){0===$(window).scrollTop()||o.is(":animated")||o.animate({scrollTop:0},"slow")}),angular.element(t).bind("scroll",function(){this.pageYOffset>=200?a.isShowTop=!0:a.isShowTop=!1,a.$apply()})}}}])}(),function(){"use strict";angular.module("jackblog.directives").directive("markdowneditor",function(){return{restrict:"A",replace:!1,link:function(t,a,e){var n=window.markdownit();n.toHTML=n.render,window.markdown=n,$(a).markdown({autofocus:!1,savable:!1})}}})}(),function(){"use strict";angular.module("jackblog.settings",[]).config(["$stateProvider",function(t){t.state("signin",{url:"/signin",templateUrl:"app/settings/local_sign_in.html",controller:"LocalSignInCtrl"}).state("setting",{url:"/setting",templateUrl:"app/settings/user_setting.html",controller:"SettingCtrl",onlyUser:!0})}])}(),function(){"use strict";angular.module("jackblog.settings").controller("SettingCtrl",["$scope","User","Auth","toaster","$state",function(t,a,e,n,o){t.user=a.get(),t.mdUser=function(e){e.$valid&&a.mdUser(t.user).then(function(a){t.user=a.data,n.pop("success","","修改资料成功")})["catch"](function(t){t=t.data.error_msg||"修改用户失败",n.pop("error","",t),o.reload()})}}])}(),function(){"use strict";angular.module("jackblog.settings").controller("SnsSignInCtrl",["$rootScope","$scope","Auth",function(t,a,e){a.loginOauth=function(a){e.snsLogin(a,t.currentUrl)}}])}(),function(){"use strict";angular.module("jackblog.settings").controller("LocalSignInCtrl",["$rootScope","$scope","Auth","$state","$log","toaster","$cookies",function(t,a,e,n,o,i,l){function s(){a.captchaUrl="/api/users/getCaptcha?"+Math.random()}function r(){e.login({email:a.user.email,password:a.user.password,captcha:a.user.captcha}).then(function(){i.pop("success","","登录成功,欢迎光临!"),n.go("home")})["catch"](function(t){a.user.captcha="",s(),t=t.error_msg||t.data.error_msg||"登录失败,请重试",i.pop("error","",t),l.remove("token")})}a.loginOauth=function(a){e.snsLogin(a,t.previousUrl)},s(),a.changeCaptcha=function(){s()},a.user={},a.login=function(t){t.$valid&&r()},a.loginPress=function(t,a){13===t.which&&a.$valid&&(t.preventDefault(),r())}}])}(),function(){"use strict";angular.module("jackblog.manage",[]).config(["$stateProvider",function(t){t.state("blogWrite",{url:"/blog_write",templateUrl:"app/manage_blog/blog_write.html",controller:"BlogWriteCtrl",onlyAdmin:!0}).state("blogList",{url:"/blog_list",templateUrl:"app/manage_blog/blog_list.html",controller:"BlogListCtrl",onlyAdmin:!0}).state("blogEdit",{url:"/blog_edit/:aid",templateUrl:"app/manage_blog/blog_edit.html",controller:"BlogEditCtrl",onlyAdmin:!0}).state("tagsManage",{url:"/tags_manage",templateUrl:"app/manage_tag/tags_manage.html",controller:"TagsManageCtrl",onlyAdmin:!0}).state("tagsList",{url:"/tags_list/:cid",templateUrl:"app/manage_tag/tags_list.html",controller:"TagsListCtrl",onlyAdmin:!0}).state("userList",{url:"/user_list",templateUrl:"app/manage_user/user_list.html",controller:"UserListCtrl",onlyAdmin:!0})}])}(),function(){"use strict";angular.module("jackblog.manage").controller("UserListCtrl",["$scope","$modal","$state","User","toaster",function(t,a,e,n,o){function i(a){n.getUserList(a,function(a){t.userList=a.data,t.bigTotalItems=a.count},function(a){t.userList=[]})}t.options={currentPage:1,itemsPerPage:10,sortName:"created",sortOrder:!1},t.changeSort=function(a){t.options.sortName===a&&(t.options.sortOrder=!t.options.sortOrder),t.options.sortName=a},t.maxSize=5,t.$watchCollection("options",function(t,a){i(t)}),t.del=function(a){confirm("你确定要删除这个用户吗?")&&n.deleteUser({id:a._id}).then(function(){o.pop("success","","删除用户"+a.nickname+"成功"),i(t.options)})["catch"](function(t){t=t.data.error_msg||"删除用户失败",o.pop("error","",t)})},t.add=function(e){var n=a.open({templateUrl:"app/manage_user/user_add.html",controller:"ModalAddUserCtrl",size:e});n.result.then(function(a){o.pop("success","","添加用户 "+a+" 成功"),i(t.options)})["catch"](function(t){t=t.message||t.data.error_msg||"添加用户失败",o.pop("error","",t)})},t.edit=function(e){var n=a.open({templateUrl:"app/manage_user/user_edit.html",controller:"ModalEditUserCtrl",resolve:{currentUser:function(){return e}}});n.result.then(function(a){o.pop("success","","编辑用户 "+a+" 成功"),i(t.options)})}}]).controller("ModalAddUserCtrl",["$scope","$modalInstance","User","toaster",function(t,a,e,n){t.user={},t.ok=function(o){o.$valid&&e.addUser(t.user).then(function(){a.close(t.user.nickname)})["catch"](function(t){t=t.data.error_msg||"添加用户失败",n.pop("error","",t)})},t.cancel=function(){a.dismiss("cancel")}}]).controller("ModalEditUserCtrl",["$scope","$modalInstance","User","toaster","currentUser",function(t,a,e,n,o){t.currentUser=o,t.ok=function(o){o.$valid&&e.updateUser(t.currentUser._id,t.currentUser).then(function(){a.close(t.currentUser.nickname)})["catch"](function(t){t=t.data.error_msg||"编辑用户失败",n.pop("error","",t)})},t.cancel=function(){a.dismiss("cancel")}}])}(),function(){"use strict";angular.module("jackblog.manage").controller("TagsManageCtrl",["$scope","$modal","Tags","toaster",function(t,a,e,n){e.getTagCatList().then(function(a){t.catList=a.data}),t.del=function(a){confirm("你确定要删除分类?")&&e.deleteCat({id:a._id}).then(function(){n.pop("success","","删除标签"+a.name+"成功")}).then(function(){return e.getTagCatList().then(function(a){t.catList=a.data})})["catch"](function(t){t=t.data.error_msg||"删除标签分类失败.",n.pop("error","",t)})},t.add=function(o){var i=a.open({templateUrl:"app/manage_tag/tag_cat_add.html",controller:"ModalAddTagCatCtrl",size:o});i.result.then(function(){n.pop("success","","添加标签分类成功"),e.getTagCatList().then(function(a){t.catList=a.data})})},t.edit=function(o){var i=a.open({templateUrl:"app/manage_tag/tag_cat_edit.html",controller:"ModalEditTagCatCtrl",resolve:{currentCat:function(){return o}}});i.result.then(function(){n.pop("success","","编辑标签分类成功"),e.getTagCatList().then(function(a){t.catList=a.data})})}}]).controller("ModalAddTagCatCtrl",["$scope","$modalInstance","Tags","toaster",function(t,a,e,n){t.cat={},t.ok=function(o){o.$valid&&e.addTagCat(t.cat).then(function(){a.close()})["catch"](function(t){t=t.data.error_msg||"添加标签分类失败.",n.pop("error","",t)})},t.cancel=function(){a.dismiss("cancel")}}]).controller("ModalEditTagCatCtrl",["$scope","$modalInstance","Tags","toaster","currentCat",function(t,a,e,n,o){t.cat=o,t.ok=function(o){o.$valid&&e.updateTagCat(t.cat._id,t.cat).then(function(){a.close()})["catch"](function(t){t=t.data.error_msg||"修改标签分类失败.",n.pop("error","",t)})},t.cancel=function(){a.dismiss("cancel")}}])}(),function(){"use strict";angular.module("jackblog.manage").controller("TagsListCtrl",["$scope","$modal","$state","$stateParams","Tags","toaster",function(t,a,e,n,o,i){t.cid=n.cid||0,o.getTagList({id:t.cid}).then(function(a){t.tagList=a.data}),o.getTagCatList().then(function(a){t.catList=a.data}),t.changeCat=function(){e.go("tagsList",{cid:t.cid})},t.del=function(a){confirm("你确定要删除标签?")&&o.deleteTag({id:a._id}).then(function(){i.pop("success","","删除标签"+a.name+"成功")}).then(function(){return o.getTagList({id:t.cid}).then(function(a){t.tagList=a.data})})["catch"](function(t){t=t.data.error_msg||"删除标签失败.",i.pop("error","",t)})},t.add=function(e){var n=a.open({templateUrl:"app/manage_tag/tag_add.html",controller:"ModalAddTagCtrl",size:e});n.result.then(function(){i.pop("success","","添加标签成功"),o.getTagList({id:t.cid}).then(function(a){t.tagList=a.data})})},t.edit=function(e){var n=a.open({templateUrl:"app/manage_tag/tag_edit.html",controller:"ModalEditTagCtrl",resolve:{currentTag:function(){return e}}});n.result.then(function(){i.pop("success","","编辑标签成功"),o.getTagList({id:t.cid}).then(function(a){t.tagList=a.data})})}}]).controller("ModalAddTagCtrl",["$scope","$modalInstance","Tags","toaster",function(t,a,e,n){e.getTagCatList().then(function(a){t.catList=a.data}),t.tag={is_show:!1,is_index:!1,sort:1},t.ok=function(o){o.$valid&&e.addTag(t.tag).then(function(){a.close()})["catch"](function(t){t=t.data.error_msg||"添加标签失败.",n.pop("error","",t)})},t.cancel=function(){a.dismiss("cancel")}}]).controller("ModalEditTagCtrl",["$scope","$modalInstance","Tags","toaster","currentTag",function(t,a,e,n,o){t.tag=o,e.getTagCatList().then(function(a){t.catList=a.data}),t.ok=function(o){o.$valid&&(t.tag.cid=t.tag.cid._id,e.updateTag(t.tag._id,t.tag).then(function(){a.close()})["catch"](function(t){t=t.data.error_msg||"更新标签失败.",n.pop("error","",t)}))},t.cancel=function(){a.dismiss("cancel")}}])}(),function(){"use strict";angular.module("jackblog.manage").controller("BlogWriteCtrl",["$scope","$state","Tags","$modal","$log","Blog","lodash","toaster",function(t,a,e,n,o,i,l,s){t.article={tags:{},top:!1,content:""},e.getTagList({id:0}).then(function(a){t.tagList=a.data}),t.addTag=function(a){a&&(t.article.tags[a._id]=a)},t.delTag=function(a){delete t.article.tags[a]},t.save=function(e){t.article.tags=l.keys(t.article.tags),t.article.status=e||0,o.debug(t.article),i.addBlog(t.article).then(function(n){e?(s.pop("success","","保存文章 "+t.article.title+" 并发布成功"),a.go("blogList")):(s.pop("success","","保存文章 "+t.article.title+" 为草稿成功"),a.go("blogEdit",{aid:n.article_id}))})["catch"](function(t){t=t.data.error_msg||"添加文章失败.",s.pop("error","",t)})},t.images=[],t.addImages=function(){var a=n.open({templateUrl:"app/manage_blog/blog_images_add.html",controller:"ModalBlogImagesAddCtrl"});a.result.then(function(a){s.pop("success","","添加图片成功"),t.images.push({url:a})})},t.showUrl=function(a){t.selectImageUrl=a},t.delImage=function(a){t.images.splice(a,1)}}]).controller("ModalBlogImagesAddCtrl",["$scope","$modalInstance","Upload","Blog","toaster",function(t,a,e,n,o){t.type="local",t.url="",t.uploadImg=function(t){if(t&&t.length)for(var n=0;n<t.length;n++){var i=t[n];e.upload({url:"/api/blog/uploadImage",file:i}).progress(function(t){parseInt(100*t.loaded/t.total)}).success(function(t,e,n,o){a.close(t.img_url)}).error(function(t,a,e,n){t=t.data.error_msg||"上传图片失败.",o.pop("error","",t)})}},t.fetchImg=function(){""!==t.url&&n.fetchImage({url:t.url}).then(function(t){a.close(t.img_url)})["catch"](function(t){t=t.data.error_msg||"抓取图片失败.",o.pop("error","",t)})},t.cancel=function(){a.dismiss("cancel")}}])}(),function(){"use strict";angular.module("jackblog.manage").controller("BlogListCtrl",["$scope","$log","Blog","toaster",function(t,a,e,n){function o(a){e.getBlogList(a).then(function(a){t.blogList=a.data,t.bigTotalItems=a.count})}t.options={currentPage:1,itemsPerPage:15,sortName:"publish_time",sortOrder:!1},t.activities=[5,10,20,40,0],t.changeSort=function(a){t.options.sortName===a&&(t.options.sortOrder=!t.options.sortOrder),t.options.sortName=a},t.maxSize=5,t.$watchCollection("options",function(t,a){o(t)}),t.del=function(a){confirm("你确定要删除这篇博客吗?")&&e.deleteBlog({id:a._id}).then(function(){n.pop("success","","删除文章 "+a.title+" 成功"),o(t.options)})["catch"](function(t){t=t.data.error_msg||"删除失败.",n.pop("error","",t)})}}])}(),function(){"use strict";angular.module("jackblog.manage").controller("BlogEditCtrl",["$scope","$state","Tags","$log","Blog","lodash","$stateParams","toaster","$modal",function(t,a,e,n,o,i,l,s,r){t.aid=l.aid,t.aid||a.go("blogList"),o.getBlog({id:t.aid}).then(function(a){t.article=a.data;var e={};i.map(t.article.tags,function(t){e[t._id]=t}),t.article.tags=e}),e.getTagList({id:0}).then(function(a){t.tagList=a.data}),t.addTag=function(a){a&&(t.article.tags[a._id]=a)},t.delTag=function(a){delete t.article.tags[a]},t.showUrl=function(a){t.selectImageUrl=a},t.delImage=function(a){t.article.images.splice(a,1)},t.addImages=function(){var a=r.open({templateUrl:"app/manage_blog/blog_images_add.html",controller:"ModalBlogImagesAddCtrl"});a.result.then(function(a){s.pop("success","","添加图片成功"),t.article.images.push({url:a})})},t.save=function(e){t.article.tags=i.keys(t.article.tags),e&&(t.article.isRePub=!0),o.updateBlog(t.article._id,t.article).then(function(){s.pop("success","","保存文章 "+t.article.title+" 成功"),a.reload()})["catch"](function(t){t=t.data.error_msg||"保存文章失败.",s.pop("error","",t)})}}])}(),function(){"use strict";angular.module("jackblog").config(["$stateProvider",function(t){t.state("home",{url:"/",templateUrl:"app/main/main.html",controller:"MainCtrl",controllerAs:"main"})}])}(),function(){"use strict";angular.module("jackblog").controller("MainCtrl",["$scope","Blog","$log","Tags",function(t,a,e,n){function o(e,n){t.isLoading=!0,a.getFrontBlogCount(e).then(function(a){t.blogCount=a.count,t.numPages=Math.ceil(t.blogCount/t.options.itemsPerPage)}),a.getFrontBlogList(e).then(function(a){t.isLoading=!1,n?t.blogList=a.data:t.blogList=t.blogList.concat(a.data)})["catch"](function(){t.isLoading=!1,t.blogList=[]})}if(n.getFrontTagList().then(function(a){t.tagList=a.data}),t.options={currentPage:1,itemsPerPage:10,sortName:"publish_time",tagId:""},localStorage.options){var i=JSON.parse(localStorage.options);t.options.sortName=i.sortName,t.options.tagId=i.tagId}t.blogList=[],o(t.options),t.loadMore=function(){t.options.currentPage++,o(t.options)},t.changeSort=function(a){t.options.currentPage=1,t.options.tagId="",t.options.sortName=a,localStorage.options=JSON.stringify(t.options),o(t.options,!0)},t.changeTag=function(a){t.options.currentPage=1,t.options.tagId=a,t.options.sortName="",localStorage.options=JSON.stringify(t.options),o(t.options,!0)}}])}(),function(){"use strict";angular.module("jackblog.article",[]).config(["$stateProvider",function(t){t.state("article",{url:"/article/:aid",templateUrl:"app/article/article.html",controller:"ArticleCtrl"})}])}(),function(){"use strict";angular.module("jackblog.article").directive("reply",["Comment","$log","toaster",function(t,a,e){return{restrict:"EA",templateUrl:"app/article/reply.directive.html",replace:!0,link:function(n,o,i){n.delReply=function(o,i,l){confirm("你确定要删除这条回复吗?")&&t.delReply(i,{rid:o}).then(function(t){a.debug(t),n.commentList[l]=t.data})["catch"](function(t){t=t.data.error_msg||"删除回复失败.",e.pop("error","",t)})}}}}])}(),function(){"use strict";angular.module("jackblog.article").directive("comment",["$rootScope","Comment","$timeout","$log","toaster","Auth",function(t,a,e,n,o,i){return{restrict:"E",templateUrl:"app/article/comment.directive.html",replace:!0,link:function(l,s,r){l.showReply=function(a,n){i.isLoggedInAsync(function(o){o?(l.isReply=!l.isReply,$("#replyContent"+a).val("@"+n+" "),e(function(){$("#replyContent"+a).focus()},0,!1)):t.opneSnsModal()})},l.submitNewReply=function(t,e,i){a.addNewReply(t,{content:e}).then(function(t){n.debug(t),l.commentList[i].replys=t.data,l.isReply=!l.isReply})["catch"](function(t){t=t.data.error_msg||"添加回复失败.",n.debug(t),o.pop("error","",t)})},l.delComment=function(t,e){confirm("删除评论会一起删除它所有回复,你确定要删除吗?")&&a.delComment({id:e}).then(function(){l.commentList.splice(t,1),o.pop("success","","删除评论成功.")})["catch"](function(t){t=t.data.error_msg||"删除评论失败.",o.pop("error","",t)})}}}}])}(),function(){"use strict";angular.module("jackblog.article").controller("ArticleCtrl",["$rootScope","$scope","$log","$state","$location","lodash","toaster","Auth","Blog","Comment","$stateParams",function(t,a,e,n,o,i,l,s,r,c,d){a.aid=d.aid,a.aid||n.go("home"),a.isAdmin=s.isAdmin,a.isLoggedIn=s.isLoggedIn,r.getFrontArticle({id:a.aid}).then(function(t){a.article=t.data}).then(function(){var t={id:a.aid,sortName:"publish_time",tagId:""};localStorage.options&&(t=i.merge(t,JSON.parse(localStorage.options))),r.getPrenext(t).then(function(t){a.next=t.data.next||{},a.prev=t.data.prev||{}})})["catch"](function(){n.go("home")}),c.getFrontCommentList({id:a.aid}).then(function(t){a.commentList=t.data})["catch"](function(t){e.debug(t),a.commentList=[]}),s.isLoggedInAsync(function(t){t?a.isLike=s.isLike(a.aid):a.isLike=!1}),a.newComment={content:""},a.submitNewComment=function(t){a.newComment.aid=t,c.addNewComment(a.newComment).then(function(t){a.commentList.push(t.data),a.newComment.content=""})["catch"](function(t){e.debug(t),l.pop("error","","评论添加错误,请重试.")})},a.goToComment=function(a){s.isLoggedInAsync(function(e){e?$("#"+a).focus():t.opneSnsModal()})},a.toggleLike=function(e){s.isLoggedInAsync(function(n){n?r.toggleLike({id:e}).then(function(t){a.article.like_count=t.count,a.isLike=t.isLike}):t.opneSnsModal()})}}])}(),angular.module("jackblog").run(["$templateCache",function(t){t.put("app/article/article.html",'<div ng-include="\'app/components/navbar/navbar.html\'"></div><div class="article-box"><div class="article-container"><h1 class="title">{{article.title}}</h1><div class="counts"><span class="views-count">阅读{{article.visit_count}}</span> <span class="comments-count">评论{{article.comment_count}}</span> <span class="likes-count">喜欢{{article.like_count}}</span> <a ng-show="isAdmin()" ui-sref="blogEdit({aid:article._id})">编辑</a></div><div class="markdown-content" ng-bind-html="article.content"></div></div><div class="article-share clearfix"><a href="javascript:;" class="like-btn" ng-class="{\'note-liked\':isLike}" ng-click="toggleLike(article._id)"><span class="like-content"><i class="fa" ng-class="{\'fa-heart-o\':!isLike,\'fa-heart\':isLike}"></i> 喜欢</span> <span class="like-count">{{article.like_count}}</span></a></div><div class="prenext"><div class="text-left prev"><a ng-if="prev._id" class="link-title" ui-sref="article({aid:prev._id})"><span>上一篇:</span> {{prev.title}}</a></div><div class="text-right next"><a ng-if="next._id" class="link-title" ui-sref="article({aid:next._id})"><span>下一篇:</span> {{next.title}}</a></div></div><div class="comment-container clearfix"><div class="comment-head clearfix">{{commentList.length || 0}}条评论 <a href="javascript:void(null)" ng-click="goToComment(\'comment_content\')" class="goto-comment pull-right"><i class="fa fa-pencil"></i>添加新评论</a></div><div id="comment_list"><comment ng-repeat="comment in commentList"></comment></div><div ng-if="!isLoggedIn()"><p class="comment-signin"><button class="btn btn-info" ng-click="opneSnsModal()">登录后发表评论</button></p></div><form ng-if="isLoggedIn()" class="new_comment" name="new_comment"><div class="comment-text"><textarea maxlength="2000" required="" ng-model="newComment.content" placeholder="写下你的评论…" id="comment_content"></textarea><div><input type="submit" ng-click="submitNewComment(article._id)" ng-disabled="new_comment.$invalid" id="comment_submit_btn" value="发 表" class="btn btn-info"></div></div></form></div><scrolltop></scrolltop></div><div class="center-footer" ng-include="\'app/components/footer/footer.html\'"></div>'),t.put("app/article/comment.directive.html",'<div class="comment-item"><div class="content"><div class="meta-top"><a class="avatar"><img ng-src="{{comment.user_id.avatar || default_avatar}}" alt="{{comment.user_id.nickname}}"></a> <a class="author-name link-light">{{comment.user_id.nickname}}</a> <span class="reply-time">{{comment.created | date:\'yyyy.MM.dd hh:mm\'}}</span></div><p class="comment-content">{{comment.content}}</p><div class="comment-footer text-right"><a class="delete" ng-if="isAdmin()" href="javascript:;" ng-click="delComment($index,comment._id)">删除</a> <a class="reply" href="javascript:void(0)" ng-click="showReply($index,comment.user_id.nickname)">回复</a></div><div class="reply-list" ng-init="isReply = false" ng-show="comment.replys.length > 0 || isReply"><reply ng-repeat="reply in comment.replys track by $index"></reply><form class="new-reply" ng-show="isReply"><div class="comment-text"><textarea id="replyContent{{$index}}" ng-model="replyContent" maxlength="2000" placeholder="写下你的回复…"></textarea><div><input type="button" ng-click="submitNewReply(comment._id,replyContent,$index)" value="发 表" id="reply_submit_btn_{{$index}}" class="btn btn-sm btn-info"></div></div></form></div></div></div>'),t.put("app/article/reply.directive.html",'<div class="reply-item"><p class="reply-content"><a class="reply-user link-light">{{reply.user_info.nickname}}</a>： {{reply.content}}</p><div class="reply-footer text-right"><a class="delete" ng-if="isAdmin()" href="javascript:;" ng-click="delReply(reply._id,comment._id,$parent.$parent.$index)">删除</a> <a class="reply" href="javascript:void(null)" ng-click="showReply($parent.$index,reply.user_info.nickname)">回复</a> <span class="reply-time pull-left">{{reply.created | date:\'yyyy.MM.dd hh:mm\'}}</span></div></div>'),
t.put("app/main/main.html",'<div ng-include="\'app/components/navbar/navbar.html\'"></div><div class="container-fluid main-box"><div class="row"><div ng-include="\'app/components/sidebar/sidebar.html\'"></div><div class="col-sm-7 col-sm-offset-3 main-content"><ul class="sort-tags list-unstyled clearfix"><li><a ng-class="{active:(options.sortName == \'publish_time\')}" ng-click="changeSort(\'publish_time\')" href="javascript:;">最新</a></li><li><a ng-class="{active:(options.sortName == \'visit_count\')}" ng-click="changeSort(\'visit_count\')" href="javascript:;">热门</a></li><li ng-repeat="tag in tagList"><a ng-class="{active:(options.tagId == tag._id)}" ng-click="changeTag(tag._id)" href="javascript:;">{{tag.name}}</a></li><li><img ng-show="isLoading" class="loader-tiny" src="/assets/images/tiny.gif" alt="Tiny"></li></ul><ul class="article-list list-unstyled clearfix"><li class="article-item" ng-class="{\'have-img\':blog.images.length>0}" ng-repeat="blog in blogList"><a ng-show="(blog.images.length > 0)" class="wrap-img" ui-sref="article({aid:blog._id})"><img ng-src="{{blog.images[0].url}}?imageView2/2/w/100/h/100"></a><div><p class="list-top"><span class="time">{{blog.publish_time | customTime}}</span></p><h4 class="title"><a class="link-title" ui-sref="article({aid:blog._id})">{{blog.title}}</a></h4><div class="list-footer"><span>阅读 {{blog.visit_count}}</span> <span>· 评论 {{blog.comment_count}}</span> <span>· 喜欢 {{blog.like_count}}</span></div></div></li><li class="no-content" ng-if="(blogCount < 1)">正在大力回车.....</li></ul><div class="load-more"><button ng-click="loadMore()" ng-disabled="isLoading" class="ladda-button" ng-show="(options.currentPage < numPages)"><span ng-hide="isLoading" class="ladda-label">点击查看更多</span> <span ng-show="isLoading" class="ladda-spinner"><i class="fa fa-spinner fa-spin"></i></span></button></div></div></div></div><div ng-include="\'app/components/footer/footer.html\'"></div>'),t.put("app/manage_blog/blog_edit.html",'<div ng-include="\'app/components/navbar/navbar.html\'"></div><div class="manage-box"><div class="manage-container write-blog"><h1 class="text-center">编辑博客</h1><hr><form class="write-blog-form" name="writeBlogForm" method="post" novalidate=""><div class="form-group"><label>标题</label> <input type="text" class="form-control" required="" ng-model="article.title" placeholder="标题"></div><div class="form-group"><label>添加标签</label><div class="row"><div class="col-xs-6"><select class="form-control" ng-model="tag" ng-options="tag as tag.name group by tag.cid.name for tag in tagList"><option value="">--请选择--</option></select></div><div class="col-xs-6"><button type="button" ng-click="addTag(tag)" class="btn btn-primary btn-block">添加</button></div></div></div><div class="form-group"><label>标签列表(双击删除)</label><div class="select-tags"><button type="button" class="btn btn-warning" ng-dblclick="delTag(key)" ng-repeat="(key, value) in article.tags">{{value.name}}</button></div></div><div class="form-group"><label>图片列表 <button type="button" ng-click="addImages()" class="btn btn-primary">添加图片</button></label> <input type="text" class="form-control show-image-url" ng-model="selectImageUrl"><div class="select-images"><div class="col-md-3 col-sm-4 col-xs-6 image-list" ng-repeat="image in article.images"><img ng-click="showUrl(image.url)" ng-src="{{image.url}}"> <button type="button" class="btn btn-default btn-sm" ng-click="showUrl(image.url)">显示URL</button> <button type="button" class="btn btn-default btn-sm" ng-click="delImage($index)">删除</button></div></div></div><div class="form-group"><label>内容</label><div><textarea id="some-textarea" class="form-control" ng-model="article.content" required="" markdowneditor="" rows="15"></textarea></div></div><div class="form-group"><label class="control-label">是否置顶</label><div><label class="radio-inline"><input type="radio" ng-model="article.top" ng-value="true"> 是</label> <label class="radio-inline"><input type="radio" ng-model="article.top" ng-value="false"> 否</label></div></div><div class="form-group"><label class="control-label">状态</label><div><label class="radio-inline"><input type="radio" ng-model="article.status" ng-value="1"> 已发布</label> <label class="radio-inline"><input type="radio" ng-model="article.status" ng-value="0"> 草稿</label></div></div><p><a ng-disabled="writeBlogForm.$invalid" class="btn btn-default btn-lg" ui-sref="article({aid:article._id})" target="_blank">预览</a> <button type="button" ng-disabled="writeBlogForm.$invalid" class="btn btn-info btn-lg" ng-click="save()">保存</button> <button type="button" ng-disabled="writeBlogForm.$invalid" class="btn btn-info btn-lg" ng-click="save(\'isRePub\')">保存并重新发布</button></p></form></div></div>'),t.put("app/manage_blog/blog_images_add.html",'<div class="modal-header"><h3 class="modal-title">添加图片</h3></div><div class="modal-body"><div class="portlet-body form"><form name="addForm" class="form-horizontal" novalidate=""><div class="form-body"><div class="text-center" style="padding: 5px;"><a href="" ng-click="type=\'local\'">本地上传</a>或<a href="" ng-click="type=\'online\'">网络图片</a></div><div class="form-group"><div class="col-md-12"><input type="text" required="" autocomplete="off" ng-show="type===\'online\'" ng-model="url" class="form-control" placeholder="图片链接"> <button ng-show="type===\'local\'" class="btn btn-info btn-block" ngf-select="" ngf-change="uploadImg($files)">选择本地图片</button></div></div></div></form></div></div><div class="modal-footer"><button class="btn btn-primary" ng-show="type===\'online\'" ng-disabled="addForm.$invalid" ng-click="fetchImg()">OK</button> <button class="btn btn-warning" ng-click="cancel()">Cancel</button></div>'),t.put("app/manage_blog/blog_list.html",'<div ng-include="\'app/components/navbar/navbar.html\'"></div><div class="manage-box"><div class="manage-container blog-manage"><h1 class="text-center">博客管理-文章列表</h1><hr><div class="table-toolbar"><div class="btn-group"><button class="btn btn-primary" ui-sref="blogWrite()">写博客 <i class="fa fa-pencil"></i></button></div><div class="btn-group pull-right"><div class="dataTables_filter"><input type="text" placeholder="搜索" ng-model="q" class="form-control input-medium"></div></div></div><div class="portlet-body table-responsive"><table class="table table-striped table-bordered table-hover table-condensed"><thead><tr><th>标题</th><th>标签数</th><th ng-click="changeSort(\'visit_count\')" class="sorting">访问数 <span ng-class="{\'icon-sort-asc\':(options.sortName === \'visit_count\' && options.sortOrder),\'icon-sort-desc\':(options.sortName === \'visit_count\' && !options.sortOrder),\'icon-sort-both\':(options.sortName !== \'visit_count\')}"></span></th><th>评论数</th><th>喜欢数</th><th>是否置顶</th><th>状态</th><th>创建时间</th><th>最后更新时间</th><th ng-click="changeSort(\'publish_time\')" class="sorting">发布时间 <span ng-class="{\'icon-sort-asc\':(options.sortName === \'publish_time\' && options.sortOrder),\'icon-sort-desc\':(options.sortName === \'publish_time\' && !options.sortOrder),\'icon-sort-both\':(options.sortName !== \'publish_time\')}"></span></th><th class="text-center">管理</th></tr></thead><tbody><tr class="odd gradeX" ng-repeat="blog in blogList | filter:q"><td><a ui-sref="article({aid:blog._id})" target="_blank">{{blog.title}}</a></td><td><span>{{blog.tags.length}}</span></td><td>{{blog.visit_count}}</td><td>{{blog.comment_count}}</td><td>{{blog.like_count}}</td><td><i class="fa fa-check text-success" ng-show="tag.is_index"></i> <i class="fa fa-times text-danger" ng-show="!tag.is_index"></i></td><td><span ng-show="blog.status">已发布</span> <span ng-show="!blog.status">草稿</span></td><td>{{blog.created | date:\'short\'}}</td><td>{{blog.updated | date:\'short\'}}</td><td>{{blog.publish_time | date:\'short\'}}</td><td class="text-center"><a ui-sref="blogEdit({aid:blog._id})">Edit</a>&nbsp;&nbsp; <a class="delete-btn" href="" ng-click="del(blog)">Delete</a>&nbsp;&nbsp; <a ui-sref="article({aid:blog._id})" target="_blank">查看文章</a></td></tr></tbody></table></div><div class="row"><div class="col-sm-5 col-xs-12"><div class="dataTables_info">Page: {{options.currentPage}} / {{numPages}} of {{bigTotalItems}}</div></div><div class="col-sm-7 col-xs-12"><pagination ng-change="pageChanged()" total-items="bigTotalItems" ng-model="options.currentPage" max-size="maxSize" items-per-page="options.itemsPerPage" class="pagination-md pull-right" boundary-links="true" rotate="false" num-pages="numPages"></pagination></div></div></div></div>'),t.put("app/manage_blog/blog_write.html",'<div ng-include="\'app/components/navbar/navbar.html\'"></div><div class="manage-box"><div class="manage-container write-blog"><h1 class="text-center">开始写博客</h1><hr><form class="write-blog-form" name="writeBlogForm" method="post" novalidate=""><div class="form-group"><label>标题</label> <input type="text" class="form-control" required="" ng-model="article.title" placeholder="标题"></div><div class="form-group"><label>添加标签</label><div class="row"><div class="col-xs-6"><select class="form-control" ng-model="tag" ng-options="tag as tag.name group by tag.cid.name for tag in tagList"><option value="">--请选择--</option></select></div><div class="col-xs-6"><button type="button" ng-click="addTag(tag)" class="btn btn-primary btn-block add-tag-btn">添加</button></div></div></div><div class="form-group"><label>标签列表(双击删除)</label><div class="select-tags"><button type="button" class="btn btn-warning" ng-dblclick="delTag(key)" ng-repeat="(key, value) in article.tags">{{value.name}}</button></div></div><div class="form-group"><label>图片列表 <button type="button" ng-click="addImages()" class="btn btn-primary">添加图片</button></label> <input type="text" class="form-control show-image-url" ng-model="selectImageUrl"><div class="select-images"><div class="col-md-3 col-sm-4 col-xs-6 image-list" ng-repeat="image in images"><img ng-click="showUrl(image.url)" ng-src="{{image.url}}"> <button type="button" class="btn btn-default btn-sm" ng-click="showUrl(image.url)">显示URL</button> <button type="button" class="btn btn-default btn-sm" ng-click="delImage($index)">删除</button></div></div></div><div class="form-group"><label>内容</label><div><textarea class="form-control" ng-model="article.content" required="" markdowneditor="" rows="15"></textarea></div></div><div class="form-group"><label class="control-label">是否置顶</label><div><label class="radio-inline"><input type="radio" ng-model="article.top" ng-value="true"> 是</label> <label class="radio-inline"><input type="radio" ng-model="article.top" ng-value="false"> 否</label></div></div><p><button type="button" ng-disabled="writeBlogForm.$invalid" class="btn btn-default btn-lg" ng-click="preview()">预览</button> <button type="button" ng-disabled="writeBlogForm.$invalid" class="btn btn-info btn-lg" ng-click="save()">保存为草稿</button> <button type="button" ng-disabled="writeBlogForm.$invalid" class="btn btn-primary btn-lg" id="save_pub_btn" ng-click="save(1)">保存并发布</button></p></form></div></div>'),t.put("app/manage_tag/tag_add.html",'<div class="modal-header"><h3 class="modal-title">添加标签</h3></div><div class="modal-body"><div class="portlet-body form"><form name="addForm" class="form-horizontal webSettingForm" novalidate=""><div class="form-body"><div class="form-group"><label class="control-label col-md-4">标签名 <span class="required">*</span></label><div class="col-md-6"><input type="text" autocomplete="off" ng-model="tag.name" required="" class="form-control"></div></div><div class="form-group"><label class="col-md-4 control-label">选择分类 <span class="required">*</span></label><div class="col-md-6"><select class="form-control" ng-model="tag.cid" ng-options="cat._id as cat.name for cat in catList"><option value="">--请选择--</option></select></div></div><div class="form-group"><label class="control-label col-md-4">排序</label><div class="col-md-6"><input type="number" autocomplete="off" ng-model="tag.sort" required="" class="form-control"></div></div><div class="form-group"><label class="control-label col-md-4">是否显示</label><div class="col-md-8"><label class="radio-inline"><input type="radio" ng-model="tag.is_show" ng-value="true"> 是</label> <label class="radio-inline"><input type="radio" ng-model="tag.is_show" ng-value="false"> 否</label></div></div><div class="form-group"><label class="control-label col-md-4">是否显示在首页</label><div class="col-md-8"><label class="radio-inline"><input type="radio" ng-model="tag.is_index" ng-value="true"> 是</label> <label class="radio-inline"><input type="radio" ng-model="tag.is_index" ng-value="false"> 否</label></div></div></div></form></div></div><div class="modal-footer"><button class="btn btn-primary" ng-disabled="addForm.$invalid" ng-click="ok(addForm)">OK</button> <button class="btn btn-warning" ng-click="cancel()">Cancel</button></div>'),t.put("app/manage_tag/tag_cat_add.html",'<div class="modal-header"><h3 class="modal-title">添加标签分类</h3></div><div class="modal-body"><div class="portlet-body form"><form name="addForm" class="form-horizontal webSettingForm" novalidate=""><div class="form-body"><div class="form-group"><label class="control-label col-md-4">分类名 <span class="required">*</span></label><div class="col-md-6"><input type="text" autocomplete="off" ng-model="cat.name" required="" class="form-control"></div></div><div class="form-group"><label class="control-label col-md-4">分类描述</label><div class="col-md-6"><textarea name="cat_desc" ng-model="cat.desc" rows="6" cols="28" class="form-control"></textarea></div></div></div></form></div></div><div class="modal-footer"><button class="btn btn-primary" ng-disabled="addForm.$invalid" ng-click="ok(addForm)">OK</button> <button class="btn btn-warning" ng-click="cancel()">Cancel</button></div>'),t.put("app/manage_tag/tag_cat_edit.html",'<div class="modal-header"><h3 class="modal-title">编辑标签分类</h3></div><div class="modal-body"><div class="portlet-body form"><form name="addForm" class="form-horizontal webSettingForm" novalidate=""><div class="form-body"><div class="form-group"><label class="control-label col-md-4">分类名 <span class="required">*</span></label><div class="col-md-6"><input type="text" autocomplete="off" ng-model="cat.name" required="" class="form-control"></div></div><div class="form-group"><label class="control-label col-md-4">分类描述</label><div class="col-md-6"><textarea name="cat_desc" ng-model="cat.desc" rows="6" cols="28" class="form-control"></textarea></div></div></div></form></div></div><div class="modal-footer"><button class="btn btn-primary" ng-disabled="addForm.$invalid" ng-click="ok(addForm)">OK</button> <button class="btn btn-warning" ng-click="cancel()">Cancel</button></div>'),t.put("app/manage_tag/tag_edit.html",'<div class="modal-header"><h3 class="modal-title">编辑标签</h3></div><div class="modal-body"><div class="portlet-body form"><form name="addForm" class="form-horizontal webSettingForm" novalidate=""><div class="form-body"><div class="form-group"><label class="control-label col-md-4">标签名 <span class="required">*</span></label><div class="col-md-6"><input type="text" autocomplete="off" ng-model="tag.name" required="" class="form-control"></div></div><div class="form-group"><label class="col-md-4 control-label">选择分类 <span class="required">*</span></label><div class="col-md-6"><select class="form-control" ng-model="tag.cid._id" ng-options="cat._id as cat.name for cat in catList"><option value="">--请选择--</option></select></div></div><div class="form-group"><label class="control-label col-md-4">排序</label><div class="col-md-6"><input type="number" autocomplete="off" ng-model="tag.sort" required="" class="form-control"></div></div><div class="form-group"><label class="control-label col-md-4">是否显示</label><div class="col-md-8"><label class="radio-inline"><input type="radio" ng-model="tag.is_show" ng-value="true"> 是</label> <label class="radio-inline"><input type="radio" ng-model="tag.is_show" ng-value="false"> 否</label></div></div><div class="form-group"><label class="control-label col-md-4">是否显示在首页</label><div class="col-md-8"><label class="radio-inline"><input type="radio" ng-model="tag.is_index" ng-value="true"> 是</label> <label class="radio-inline"><input type="radio" ng-model="tag.is_index" ng-value="false"> 否</label></div></div></div></form></div></div><div class="modal-footer"><button class="btn btn-primary" ng-disabled="addForm.$invalid" ng-click="ok(addForm)">OK</button> <button class="btn btn-warning" ng-click="cancel()">Cancel</button></div>'),t.put("app/manage_tag/tags_list.html",'<div ng-include="\'app/components/navbar/navbar.html\'"></div><div class="manage-box"><div class="manage-container tags-manage"><h1 class="text-center">标签管理-标签列表</h1><hr><div class="table-toolbar"><div class="btn-group"><button class="btn btn-primary" ng-click="add()">添加标签 <i class="fa fa-plus"></i></button></div><div class="btn-group pull-right" dropdown="" is-open="status.isopena"><select ng-change="changeCat()" class="form-control" ng-model="cid" ng-options="cat._id as cat.name for cat in catList"><option value="">--全部标签--</option></select></div></div><div class="portlet-body table-responsive"><table class="table table-striped table-bordered table-hover table-condensed"><thead><tr><th>标签名</th><th>所属分类</th><th>排序</th><th>是否显示</th><th>是否首页</th><th class="text-center">管理</th></tr></thead><tbody><tr class="odd gradeX" ng-repeat="tag in tagList"><td><span>{{tag.name}}</span></td><td><span>{{tag.cid.name}}</span></td><td>{{tag.sort}}</td><td><i class="fa fa-check text-success" ng-show="tag.is_show"></i> <i class="fa fa-times text-danger" ng-show="!tag.is_show"></i></td><td><i class="fa fa-check text-success" ng-show="tag.is_index"></i> <i class="fa fa-times text-danger" ng-show="!tag.is_index"></i></td><td class="text-center"><a href="" ng-click="edit(tag)">Edit</a>&nbsp;&nbsp; <a href="" ng-click="del(tag)">Delete</a></td></tr></tbody></table></div></div></div>'),t.put("app/manage_tag/tags_manage.html",'<div ng-include="\'app/components/navbar/navbar.html\'"></div><div class="manage-box"><div class="manage-container tag-cat-manage"><h1 class="text-center">标签管理-分类列表</h1><hr><div class="table-toolbar"><div class="btn-group"><button class="btn btn-primary" ng-click="add()">添加标签分类 <i class="fa fa-plus"></i></button></div></div><div class="portlet-body table-responsive"><table class="table table-striped table-bordered table-hover table-condensed"><thead><tr><th>分类名</th><th>描述</th><th class="text-center">管理</th></tr></thead><tbody><tr class="odd gradeX" ng-repeat="cat in catList"><td><a ui-sref="tagsList({cid:cat._id})">{{cat.name}}</a></td><td><span>{{cat.desc}}</span></td><td class="text-center"><a href="" ng-click="edit(cat)">Edit</a>&nbsp;&nbsp; <a href="" ng-click="del(cat)">Delete</a></td></tr></tbody></table></div></div></div>'),t.put("app/manage_user/user_add.html",'<div class="modal-header"><h3 class="modal-title">Add User</h3></div><div class="modal-body"><div class="portlet-body form"><form name="addUserForm" class="form-horizontal" novalidate=""><div class="form-body"><div class="form-group"><label class="control-label col-md-4">Nick Name <span class="required">*</span></label><div class="col-md-6"><input type="text" placeholder="呢称" autocomplete="off" ng-model="user.nickname" required="" class="form-control"></div></div><div class="form-group"><label class="control-label col-md-4">Email <span class="required">*</span></label><div class="col-md-6"><input type="email" placeholder="邮箱" autocomplete="off" ng-model="user.email" required="" class="form-control"></div></div><div class="form-group"><label class="control-label col-md-4">Password <span class="required">*</span></label><div class="col-md-6"><input type="password" placeholder="密码" autocomplete="off" ng-model="user.password" required="" class="form-control"></div></div><div class="form-group"><label class="control-label col-md-4">Status <span class="required">*</span></label><div class="col-md-8"><label class="radio-inline"><input type="radio" ng-model="user.status" value="1"> Authenticated</label> <label class="radio-inline"><input type="radio" ng-model="user.status" value="0"> Unverified</label> <label class="radio-inline"><input type="radio" ng-model="user.status" value="2"> Blocked</label></div></div></div></form></div></div><div class="modal-footer"><button class="btn btn-primary" ng-disabled="addUserForm.$invalid" ng-click="ok(addUserForm)">OK</button> <button class="btn btn-warning" ng-click="cancel()">Cancel</button></div>'),t.put("app/manage_user/user_edit.html",'<div class="modal-header"><h3 class="modal-title">Edit User</h3></div><div class="modal-body"><div class="portlet-body form"><form name="editUserForm" class="form-horizontal" novalidate=""><div class="form-body"><div class="form-group"><label class="control-label col-md-4">Nick Name <span class="required">*</span></label><div class="col-md-6"><input type="text" required="" autocomplete="off" ng-model="currentUser.nickname" class="form-control"></div></div><div class="form-group"><label class="control-label col-md-4">Email</label><div class="col-md-6"><input type="email" autocomplete="off" ng-model="currentUser.email" class="form-control"></div></div><div class="form-group"><label class="control-label col-md-4">是否修改密码(可选)</label><div class="col-md-6"><input type="password" autocomplete="off" ng-model="currentUser.newPassword" class="form-control"></div></div><div class="form-group"><label class="control-label col-md-4">Status <span class="required">*</span></label><div class="col-md-8"><label class="radio-inline"><input type="radio" ng-model="currentUser.status" value="1"> Authenticated</label> <label class="radio-inline"><input type="radio" ng-model="currentUser.status" value="0"> Unverified</label> <label class="radio-inline"><input type="radio" ng-model="currentUser.status" value="2"> Blocked</label></div></div></div></form></div></div><div class="modal-footer"><button class="btn btn-primary" ng-disabled="editUserForm.$invalid" ng-click="ok(editUserForm)">OK</button> <button class="btn btn-warning" ng-click="cancel()">Cancel</button></div>'),t.put("app/manage_user/user_list.html",'<div ng-include="\'app/components/navbar/navbar.html\'"></div><div class="manage-box"><div class="manage-container user-manage"><h1 class="text-center">用户管理-用户列表</h1><hr><div class="table-toolbar"><div class="btn-group"><button class="btn btn-primary" ng-click="add()">增加用户 <i class="fa fa-plus"></i></button></div><div class="btn-group pull-right"><div class="dataTables_filter"><input type="text" placeholder="搜索" ng-model="q" class="form-control input-medium"></div></div></div><div class="portlet-body table-responsive"><table class="table table-striped table-bordered table-hover table-condensed"><thead><tr><th>呢称</th><th>Email</th><th>角色</th><th>状态</th><th>注册方式</th><th>注册时间</th><th>更新时间</th><th class="text-center">管理</th></tr></thead><tbody><tr class="odd gradeX" ng-repeat="user in userList | filter:q"><td><span>{{user.nickname}}</span></td><td><span>{{user.email}}</span></td><td><span>{{user.role}}</span></td><td><span class="label label-sm" ng-class="{\'label-success\': (user.status == 1),\'label-warning\':(user.status == 0),\'label-default\':(user.status == 2)}">{{user.status | userStatus}}</span></td><td>{{user.provider}}</td><td>{{user.created | date:\'short\'}}</td><td>{{user.updated | date:\'short\'}}</td><td class="text-center"><a href="" ng-click="edit(user)">Edit</a>&nbsp;&nbsp; <a href="" ng-click="del(user)">Delete</a></td></tr></tbody></table></div><div class="row"><div class="col-sm-5 col-xs-12"><div class="dataTables_info">Page: {{options.currentPage}} / {{numPages}} of {{bigTotalItems}}</div></div><div class="col-sm-7 col-xs-12"><pagination ng-change="pageChanged()" total-items="bigTotalItems" ng-model="options.currentPage" max-size="maxSize" items-per-page="options.itemsPerPage" class="pagination-md pull-right" boundary-links="true" rotate="false" num-pages="numPages"></pagination></div></div></div></div>'),t.put("app/settings/local_sign_in.html",'<div ng-include="\'app/components/navbar/navbar.html\'"></div><div class="signin-box"><div class="signin-container"><h4 class="title">登 录</h4><form class="signin-form form-horizontal" name="signinForm" ng-submit="login(signinForm)" ng-keypress="loginPress($event,signinForm)" novalidate=""><div class="form-group"><div class="input-group"><div class="input-group-addon"><i class="fa fa-envelope-o"></i></div><input type="text" required="" email="" ng-minlength="3" ng-maxlength="30" ng-model="user.email" class="form-control" placeholder="邮箱"></div></div><div class="form-group"><div class="input-group"><div class="input-group-addon"><i class="fa fa-unlock-alt"></i></div><input type="password" required="" ng-model="user.password" class="form-control" placeholder="密码"></div></div><div class="form-group"><div class="col-xs-6 captcha-code"><input class="form-control" required="" maxlength="6" type="text" name="captcha" ng-model="user.captcha" placeholder="验证码"></div><div class="col-xs-6 captcha-img"><a href="javascript:;" ng-click="changeCaptcha()"><img ng-src="{{captchaUrl}}"></a></div></div><div class="form-group"><button class="btn btn-primary btn-lg btn-block" type="submit" ng-disabled="signinForm.$invalid" id="signin_btn">登 录</button></div></form><div class="login-sns"><p>您还可以通过以下方式直接登录</p><ul><li ng-click="loginOauth(\'github\')"><a class="github" href="javascript:;"><i class="fa fa-github"></i></a></li><li ng-click="loginOauth(\'wiebo\')"><a class="weibo" href="javascript:;"><i class="fa fa-weibo"></i></a></li><li ng-click="loginOauth(\'qq\')"><a class="qq" href="javascript:;"><i class="fa fa-qq"></i></a></li></ul></div></div></div>'),t.put("app/settings/sns_sign_in.html",'<div class="modal-header"><h4 class="modal-title text-center">请用以下方式登录</h4></div><div class="modal-body"><div class="portlet-body"><div class="login-sns"><ul><li ng-click="loginOauth(\'github\')"><a class="github" href="javascript:;"><i class="fa fa-github"></i></a></li><li ng-click="loginOauth(\'weibo\')"><a class="weibo" href="javascript:;"><i class="fa fa-weibo"></i></a></li><li ng-click="loginOauth(\'qq\')"><a class="qq" href="javascript:;"><i class="fa fa-qq"></i></a></li></ul></div></div></div>'),t.put("app/settings/user_setting.html",'<div ng-include="\'app/components/navbar/navbar.html\'"></div><div class="settings-box"><div class="settings-container"><h2 class="title">设置</h2><hr><div class="profile"><div class="control-group"><form class="settings-form" name="settingForm" ng-submit="mdUser(settingForm)" novalidate=""><div class="form-group"><label class="control-label">昵称</label> <input placeholder="2-15字符，中英文、数字和下划线" required="" nickname="" type="text" class="form-control" ng-minlength="2" ng-maxlength="15" ng-model="user.nickname"></div><button type="submit" class="btn btn-block btn-lg btn-primary" ng-disabled="settingForm.$invalid">保 存</button></form></div></div></div></div>'),t.put("app/components/footer/footer.html",'<footer ng-controller="FooterCtrl"><div class="footer-container"><ul><li><span>{{beian}}</span></li><li><a class="github" href="https://github.com/jackhutu" target="_blank"><i class="fa fa-github"></i></a></li><li><a class="weibo" href="http://weibo.com/hutaigong" target="_blank"><i class="fa fa-weibo"></i></a></li></ul></div></footer>'),t.put("app/components/navbar/navbar.html",'<div class="navbar-box navbar-skin" ng-controller="NavbarCtrl"><div class="navbar-menu"><a class="navbar-item active logo" title="首页" href="/">Hu</a></div><div class="navbar-expanded"><div ng-if="isAdmin()"><a class="navbar-item" ui-sref-active="active" ui-sref="userList()" tooltip-placement="right" tooltip-class="nav-tooltip" tooltip="用户管理"><i class="fa fa-users"></i></a> <a class="navbar-item" ui-sref-active="active" ui-sref="blogList()" tooltip-placement="right" tooltip-class="nav-tooltip" tooltip="文章管理"><i class="fa fa-book"></i></a> <a class="navbar-item" ui-sref-active="active" ui-sref="tagsManage()" tooltip-placement="right" tooltip-class="nav-tooltip" tooltip="标签管理"><i class="fa fa-tags"></i></a></div><div><a class="navbar-item change-mode" href="javascript:;" ng-click="changeMode()" tooltip-placement="right" tooltip-class="nav-tooltip" tooltip="模式切换"><i ng-if="dayMode" class="fa fa-moon-o"></i> <i ng-if="!dayMode" class="fa fa-sun-o"></i></a></div><div ng-if="isLoggedIn()"><a href="javascript:;" class="navbar-item expanded-logout" ng-click="logout()" tooltip-class="nav-tooltip" tooltip-placement="right" tooltip="登出"><i class="fa fa-sign-out"></i></a> <a class="navbar-item expanded-avatar" ui-sref="setting()" tooltip-class="nav-tooltip" tooltip-placement="right" tooltip="{{getCurrentUser().nickname}}"><img ng-src="{{ getCurrentUser().avatar || default_avatar}}"></a></div><div ng-if="!isLoggedIn()"><a class="navbar-item" ui-sref-active="active" ui-sref="signin()" tooltip-class="nav-tooltip" tooltip-placement="right" tooltip="登录"><i class="fa fa-sign-in"></i></a></div></div><div class="navbar-shrink"><div ng-if="isLoggedIn()" class="pull-right" dropdown="" is-open="status.isopen"><a href="javascript:;" class="shrink-avatar dropdown-toggle" data-toggle="dropdown" dropdown-toggle="" ng-disabled="disabled"><img ng-src="{{ getCurrentUser().avatar || default_avatar}}"></a><ul class="dropdown-menu" role="navbarList"><li ng-if="isAdmin()"><a href="/user_list"><i class="fa fa-users"></i> 用户管理</a> <a href="/blog_list"><i class="fa fa-book"></i> 文章管理</a> <a href="/tags_manage"><i class="fa fa-tags"></i> 标签管理</a></li><li><a ui-sref="setting()"><i class="fa fa-cog"></i> 设置</a></li><li class="divider"></li><li><a href="javascript:;" class="shrink-logout" ng-click="logout()"><i class="fa fa-sign-out"></i> 登出</a></li></ul></div><div class="pull-right"><a class="navbar-item change-mode" href="javascript:;" ng-click="changeMode()"><i ng-if="dayMode" class="fa fa-moon-o"></i> <i ng-if="!dayMode" class="fa fa-sun-o"></i></a></div><div ng-if="!isLoggedIn()" class="pull-right"><a class="shrink-login" ui-sref="signin()"><i class="fa fa-sign-in"></i> 登录</a></div></div></div>'),t.put("app/components/sidebar/sidebar.html",'<div class="col-sm-3 sidebar-box" ng-controller="SidebarCtrl"><div class="cover-img" style="background-image: url({{indexImg}})"></div><div class="bottom-block"><h1>{{name}}</h1><h3>有朋自远方来</h3><h3>不亦乐乎</h3></div></div>')}]);